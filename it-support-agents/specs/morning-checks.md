# Morning Checks

Behavioral specification for daily operational health checks — what to check, how to assess findings, and when to take action.

## Check Scope

Morning checks cover all system groups defined in `config/framework.yaml` under `morning_checks.system_groups`. The standard groups are:

### Production Servers
- **Checks**: CPU, memory, disk, service status, uptime
- **Skills used**: `server-health` for each server in the group
- **Frequency**: Every morning, all servers

### Databases
- **Checks**: Connection pool status, replication lag, disk usage, backup status, slow query count
- **Skills used**: `server-health` (resource metrics), `log-analysis` (error logs)
- **Frequency**: Every morning, all database instances

### Network
- **Checks**: Link status, bandwidth utilization, VPN tunnel status, DNS resolution, certificate expiry
- **Skills used**: `server-health` (connectivity), `log-analysis` (network device logs)
- **Frequency**: Every morning

### Security
- **Checks**: Failed login attempts (past 24h), firewall rule changes, antivirus status, certificate expiry warnings
- **Skills used**: `log-analysis` (security logs), `server-health` (security service status)
- **Frequency**: Every morning

## Thresholds

Thresholds are defined in the active environment config (`config/environments/<env>.yaml`). Morning checks apply the following status classifications:

### GREEN — Normal
- All metrics within normal operating range
- All expected services running
- No new errors in logs above baseline
- Backup completed successfully
- Certificate expiry > 30 days

### AMBER — Warning
- One or more metrics exceed warning threshold but are below critical
- Non-critical service in degraded state
- Error rate elevated above baseline but not critical
- Backup completed with warnings
- Certificate expiry between 14 and 30 days

### RED — Critical
- One or more metrics exceed critical threshold
- Critical service is down or unresponsive
- Error rate spike indicating active issue
- Backup failed
- Certificate expiry < 14 days

## Trend Analysis Rules

### When to escalate AMBER to RED
- An AMBER finding that persists for 3+ consecutive days → treat as RED
- An AMBER finding that is worsening (trending toward critical threshold) → treat as RED
- Multiple AMBER findings in the same system group → treat the group as RED

### What constitutes a trend
- **Increasing**: Value has risen for 3+ consecutive checks
- **Decreasing**: Value has dropped for 3+ consecutive checks
- **Stable**: Value varies less than 5% between checks
- **Volatile**: Value varies more than 20% between checks (flag as unusual)

### Comparison data
- Compare against yesterday's morning check report (if available)
- Compare against the 7-day average for each metric
- If comparison data is unavailable, note: "No previous data for comparison"

## Report Requirements

Every morning check report must include:

### Header
- Date and time of check
- Environment checked (prod/staging)
- Generated by: IT Support Agent
- Overall status: GREEN / AMBER / RED (worst status across all groups)

### Per System Group
- Group name and overall status (GREEN/AMBER/RED)
- Total systems checked / total in group
- Findings count by status
- Trend indicator compared to yesterday (↑ improving, → stable, ↓ degrading)

### Findings Detail
- Every AMBER and RED finding listed with:
  - System name
  - Metric and current value
  - Threshold exceeded
  - Trend (compared to yesterday)
  - Recommended action

### Summary
- Total checks performed
- GREEN/AMBER/RED counts
- Key action items (numbered list)
- Notable changes from yesterday

Use the `report-generation` skill with `templates/morning-check-report.md` to produce the report.

## Incident Creation Rules

### When to auto-create incidents from findings

**Always create an incident for:**
- Any RED finding (critical threshold exceeded)
- Any service that is down or unresponsive
- Backup failure
- Certificate expiry < 7 days
- Security findings (unusual failed login patterns, firewall changes)

**Do NOT auto-create incidents for:**
- AMBER findings (warning only — note in report)
- GREEN findings (normal — no action needed)
- Known issues that already have an open incident ticket

### Incident creation behavior by autonomy level

- **L1**: Present a list of recommended incidents with pre-filled details — human creates them
- **L2**: Create P3/P4 incidents automatically; present P1/P2 for human approval
- **L3+**: Create all incidents automatically, notify the team

### Incident details from morning check
- **Summary**: "[Morning Check] <system> — <finding>"
- **Category**: Based on system group and finding type (per `specs/incident-management.md`)
- **Priority**: RED findings default to P2; escalate to P1 if business-critical (from CMDB)
- **Description**: Include the finding details, current value, threshold, trend data
- **Link**: Reference the morning check report
